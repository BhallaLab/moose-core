language: cpp
sudo: required
group: edge

services: 
    - docker

os:
- linux
- osx
notifications:
    email:
        recipients:
            - dilawar.s.rajput@gmail.com
        on_success: change
        on_failure: always

env:
    - CTEST_MODEL=Nightly
cache: apt

matrix:
    allow_failures:

before_script:
    - sudo apt-get install -qq libxml2-dev libbz2-dev
    - sudo apt-get install -qq libhdf5-serial-dev
    - sudo apt-get install -qq make cmake
    - sudo apt-get install -qq  python-numpy python-matplotlib
    - sudo apt-get install -qq  python3-numpy python3-matplotlib python3-dev
    - sudo apt-get install -qq libboost-all-dev
    - sudo apt-get install -qq libgsl0-dev
    - wget http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1404/x86_64/cuda-repo-ubuntu1404_7.5-18_amd64.deb
    - sudo dpkg -i cuda-repo*.deb
    - sudo apt-get update 
    - sudo apt-get install -qq cuda-toolkit-7-5

install:
    - echo "nothing to do here"

before_script:
- echo "OSX related"
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then nvm get head || true; fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then ./.travis/travis_prepare_osx.sh; fi
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo ./.travis/travis_prepare_linux.sh;
  fi
script:
    - sudo ldconfig /usr/lib64
    - mkdir -p _CUDA_BUILD && cd _CUDA_BUILD 
    - cmake -DDEBUG=ON -DWITH_CUDA=ON -DPYTHON_EXECUTABLE=/usr/bin/python ..
    - make && ctest --output-on-failure
